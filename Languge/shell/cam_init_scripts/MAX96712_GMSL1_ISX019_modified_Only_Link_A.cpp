/**************************************************
This is a programming example for MAX96712 pairing with GMSL1 Serializers; Modify based on applications.

Example Setup Details:
MAX96705 #1 -----------------------------> MAX96712 Link A -------------> Map to VC0, Aggregated on 1x4 D-PHY Port A
Parallel YUV422					   ------> Pipe 0 (by default)
MAX96705 #2 -----------------------------> MAX96712 Link B -------------> Map to VC1, Aggregated on 1x4 D-PHY Port A
Parallel YUV422					   ------> Pipe 1 (by default)
MAX96705 #3 -----------------------------> MAX96712 Link C -------------> Map to VC2, Aggregated on 1x4 D-PHY Port A
Parallel YUV422					   ------> Pipe 2 (by default)
MAX96705 #4 -----------------------------> MAX96712 Link D -------------> Map to VC3, Aggregated on 1x4 D-PHY Port A
Parallel YUV422					   ------> Pipe 3 (by default)

*Serializers/Cameras I2C writes are broadcasted 
*************************************************/
// I2C write format:
// [Words to Write][I2C Slave address][I2C Register Address MSB][I2C Register Address LSB][Data Word]


// Begin of Script
// MAX96712 Link Initialization to pair with GMSL1 Serializers
0x04,0x52,0x00,0x06,0x0F, // GMSL1 mode for all links
0x04,0x52,0x00,0x10,0x11, // Set 3Gbps link Rx rate for GMSL1
0x04,0x52,0x00,0x11,0x11,
0x04,0x52,0x00,0x18,0x0F, // One-shot link reset for all
0x00,0x7F, // Delay ~100ms

// Power up sequence for GMSL1 HIM capable serializers; Also apply to Ser with power up status unknown
// Turn on HIM on MAX96712
0x04,0x52,0x0B,0x06,0xEF,
0x04,0x52,0x0C,0x06,0xEF,
0x04,0x52,0x0D,0x06,0xEF,
0x04,0x52,0x0E,0x06,0xEF,
// *CLINK should be up if SER is with HIM at power up; Otherwise continue.
// Enable everse channel cfg and turn on local I2C ack
0x04,0x52,0x0B,0x0D,0x81,
0x04,0x52,0x0C,0x0D,0x81,
0x04,0x52,0x0D,0x0D,0x81,
0x04,0x52,0x0E,0x0D,0x81,
// Turn off HIM on Ser
0x03,0x80,0x4D,0x40,
0x00,0x0A, // Delay 10ms
// Turn off HIM on MAX96712 
0x04,0x52,0x0B,0x06,0x6F,
0x04,0x52,0x0C,0x06,0x6F,
0x04,0x52,0x0D,0x06,0x6F,
0x04,0x52,0x0E,0x06,0x6F,
// One-shot link reset for all links
0x04,0x52,0x00,0x18,0x0F,
0x00,0x7F, // Delay ~100ms
// Manually override of reverse channel pulse length
0x04,0x52,0x14,0xC5,0xAA,
0x04,0x52,0x15,0xC5,0xAA,
0x04,0x52,0x16,0xC5,0xAA,
0x04,0x52,0x17,0xC5,0xAA,
// Manually override of reverse channel rise fall time setting
0x04,0x52,0x14,0xC4,0x8A,
0x04,0x52,0x15,0xC4,0x8A,
0x04,0x52,0x16,0xC4,0x8A,
0x04,0x52,0x17,0xC4,0x8A,
// Manually override TxAmp
0x04,0x52,0x14,0x95,0x88,
0x04,0x52,0x15,0x95,0x88,
0x04,0x52,0x16,0x95,0x88,
0x04,0x52,0x17,0x95,0x88,
// Enable config link on Ser
0x03,0x80,0x04,0x43,   
0x00,0x05, // Delay 5ms
// * CLINK should be up
// Disable forward control channel
0x04,0x52,0x0B,0x04,0x02,
0x04,0x52,0x0C,0x04,0x02,
0x04,0x52,0x0D,0x04,0x02,
0x04,0x52,0x0E,0x04,0x02,
0x00,0x05, // Delay 5ms
// Turn on HIM on Ser
0x03,0x80,0x4D,0xC0,
0x00,0x05, // Delay 5ms
// Turn on HIM on MAX96712
0x04,0x52,0x0B,0x06,0xEF,
0x04,0x52,0x0C,0x06,0xEF,
0x04,0x52,0x0D,0x06,0xEF,
0x04,0x52,0x0E,0x06,0xEF,
// Manually override of reverse channel pulse length to default
0x04,0x52,0x14,0xC5,0x40,
0x04,0x52,0x15,0xC5,0x40,
0x04,0x52,0x16,0xC5,0x40,
0x04,0x52,0x17,0xC5,0x40,
// Manually override of reverse channel rise fall time setting to default
0x04,0x52,0x14,0xC4,0x40,
0x04,0x52,0x15,0xC4,0x40,
0x04,0x52,0x16,0xC4,0x40,
0x04,0x52,0x17,0xC4,0x40,
// Manually override TxAmp to default
0x04,0x52,0x14,0x95,0x69,
0x04,0x52,0x15,0x95,0x69,
0x04,0x52,0x16,0x95,0x69,
0x04,0x52,0x17,0x95,0x69,
// Enable forward control channel
0x04,0x52,0x0B,0x04,0x03,
0x04,0x52,0x0C,0x04,0x03,
0x04,0x52,0x0D,0x04,0x03,
0x04,0x52,0x0E,0x04,0x03,
// Enable Packet-based control channel
0x04,0x52,0x0B,0x08,0x25,
0x00,0x0A, // Delay 10ms
0x04,0x52,0x0C,0x08,0x25,
0x00,0x0A, // Delay 10ms
0x04,0x52,0x0D,0x08,0x25,
0x00,0x0A, // Delay 10ms
0x04,0x52,0x0E,0x08,0x25,
0x00,0x0A, // Delay 10ms
// Disable HS DE processing
0x04,0x52,0x0B,0x0F,0x01,
0x04,0x52,0x0C,0x0F,0x01,
0x04,0x52,0x0D,0x0F,0x01,
0x04,0x52,0x0E,0x0F,0x01,


// ***************** MAX96712 Setting ****************
// Enable the link
0x04,0x52,0x00,0x06,0x01, // Link A for testing

// Video Pipe Selection (not available for GMSL1 but at least one of the pipes needs to be on)
0x04,0x52,0x00,0xF4,0x0F,
// YUV422 software override for all pipes since connected GMSL1 is under parallel mode
0x04,0x52,0x04,0x0B,0x42, //8 bpp for DT 0x1E
0x04,0x52,0x04,0x0C,0x00,
0x04,0x52,0x04,0x0D,0x00,
0x04,0x52,0x04,0x0E,0x5E, //DT 0x1E
0x04,0x52,0x04,0x0F,0x7E, //DT 0x1E
0x04,0x52,0x04,0x10,0x7A, //DT 0x1E
0x04,0x52,0x04,0x11,0x48, //8 bpp for DT 0x1E
0x04,0x52,0x04,0x12,0x20, //8 bpp for DT 0x1E

// Turn on the mux mode
0x04,0x52,0x04,0x1A,0xF0,

// MIPI PHY Setting
// Set Des in 2x4 mode
0x04,0x52,0x08,0xA0,0x04,
// Set Lane Mapping for 4-lane port A
0x04,0x52,0x08,0xA3,0xE4,
0x04,0x52,0x08,0xA4,0xE4,
// Set 4 lane D-PHY
0x04,0x52,0x09,0x0A,0xC0,
0x04,0x52,0x09,0x4A,0xC0,
0x04,0x52,0x09,0x8A,0xC0,
0x04,0x52,0x09,0xCA,0xC0,
// Turn on MIPI PHYs
0x04,0x52,0x08,0xA2,0xF0,
// Set Data rate to be 600Mbps/lane for port A and enable software override
0x04,0x52,0x04,0x15,0xE6,
0x04,0x52,0x04,0x18,0xE6,

// Video Pipe to MIPI Controller Mapping
// YUV422, video pipe 0, map FS/FE
0x04,0x52,0x09,0x0B,0x07,
0x04,0x52,0x09,0x2D,0x15, // map to MIPI Controller 1
0x04,0x52,0x09,0x0D,0x1E,
0x04,0x52,0x09,0x0E,0x1E, // map to VC0
0x04,0x52,0x09,0x0F,0x00,
0x04,0x52,0x09,0x10,0x00,
0x04,0x52,0x09,0x11,0x01,
0x04,0x52,0x09,0x12,0x01,
// YUV422, video pipe 1, map FS/FE
0x04,0x52,0x09,0x4B,0x07,
0x04,0x52,0x09,0x6D,0x15, // map to MIPI Controller 1
0x04,0x52,0x09,0x4D,0x1E,
0x04,0x52,0x09,0x4E,0x5E, // map to VC1
0x04,0x52,0x09,0x4F,0x00,
0x04,0x52,0x09,0x50,0x40,
0x04,0x52,0x09,0x51,0x01,
0x04,0x52,0x09,0x52,0x41,
// RYUV422, video pipe 2, map FS/FE
0x04,0x52,0x09,0x8B,0x07,
0x04,0x52,0x09,0xAD,0x15, // map to MIPI Controller 1
0x04,0x52,0x09,0x8D,0x1E,
0x04,0x52,0x09,0x8E,0x9E, // map to VC2
0x04,0x52,0x09,0x8F,0x00,
0x04,0x52,0x09,0x90,0x80,
0x04,0x52,0x09,0x91,0x01,
0x04,0x52,0x09,0x92,0x81,
// YUV422, video pipe 3, map FS/FE
0x04,0x52,0x09,0xCB,0x07,
0x04,0x52,0x09,0xED,0x15, // map to MIPI Controller 1
0x04,0x52,0x09,0xCD,0x1E,
0x04,0x52,0x09,0xCE,0xDE, // map to VC3
0x04,0x52,0x09,0xCF,0x00,
0x04,0x52,0x09,0xD0,0xC0,
0x04,0x52,0x09,0xD1,0x01,
0x04,0x52,0x09,0xD2,0xC1,

0x00,0x0F, // Delay 15ms

// Enable HVEN, HIBW, DBL on Ser depends on applications
0x03,0x80,0x07,0xC4,
0x00,0x05, // Delay 5ms
// Enable HVEN, HIBW, DBL on MAX96712 depends on applications
0x04,0x52,0x0B,0x07,0x8C,
0x04,0x52,0x0C,0x07,0x8C,
0x04,0x52,0x0D,0x07,0x8C,
0x04,0x52,0x0E,0x07,0x8C,
// Enable SER link
0x03,0x80,0x04,0x83,
// End of Script